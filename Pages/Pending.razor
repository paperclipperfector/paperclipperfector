@page "/pending"

@using PaperclipPerfector.Components
@using PaperclipPerfector.Data

@implements IDisposable

<h1>Pending AAQCs</h1>

@foreach (var post in posts)
{
    <div class="post">
        <ReportWidget post="@post" />
        <div class="body">@((MarkupString)post.html)</div>
        <ReportWidget post="@post" controls="true" />
    </div>
}

@code {
    private Db.Post[] posts = null;

    protected override void OnInitialized()
    {
        Db.Instance.RegisterCallback(StateHasChangedThreadsafe);

        posts = Db.Instance.ReadAllPosts(Db.PostState.Pending);
    }

    public void StateHasChangedThreadsafe()
    {
        InvokeAsync(StateHasChanged).ContinueInBackground();
    }

    public void Dispose()
    {
        Db.Instance.UnregisterCallback(StateHasChangedThreadsafe);
    }
}
